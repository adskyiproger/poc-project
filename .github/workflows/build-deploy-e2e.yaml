name: Build and deploy to e2e on push

on:
  push:
    branches: [ "*" ]
  pull_request:
    types:
        - labeled
        - opened

jobs:
  dispatch-deploy:
    runs-on: ubuntu-24.04
    steps:
      - run: echo ${{ github.event }}
      - uses: 8BitJonny/gh-get-current-pr@3.0.0
        if: github.event == 'push'
        id: PR

      - name: Print event type
        run: echo "Event type ${{ github.event_name }}"
      - name: On pull request
        if: github.event == 'pull_request'
        run: |
          pr_labels=$(jq -r '.label.name' "$GITHUB_EVENT_PATH")
          echo $pr_labels
      - name: Check if added label is "ðŸ”’ Keep e2e"
        id: label_check
        run: |
          echo ${{ steps.PR.outputs.pr_labels }}

          if [[ "${{ steps.PR.outputs.pr_labels }}" != *"ðŸ”’ Keep e2e"* ]]; then
            echo "Label not found or incorrect, skipping dispatch."
            echo keep_e2e=false >> $GITHUB_ENV
          else
            echo "Correct label added, dispatching deploy workflow."
            echo keep_e2e=true >> $GITHUB_ENV
          fi
      - if: steps.PR.outputs.pr_found == 'true'
        run: |
          echo "Running deployment"
          echo ${{steps.PR.outputs.pr_found}}
          echo ${{env.keep_e2e}}

